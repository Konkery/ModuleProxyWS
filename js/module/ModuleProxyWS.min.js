class ProxyWS{constructor(_wss){this._WSS=_wss,this._SubID={},Object.on("repl-sub",(id,key)=>{this._WSS._Clients.filter(client=>client.key.hashed===key).forEach(client=>{client.RegServices.includes("repl")||client.RegServices.push("Repl")}),this._SubID[id]||(this._SubID[id]=key)}),Object.on("sensor-sub",(id,key)=>{this._WSS._Clients.filter(client=>client.key.hashed===key).forEach(client=>{client.RegServices.includes("sensor")||client.RegServices.push("Sensor")}),this._SubID[id]||(this._SubID[id]=key)}),Object.on("process-sub",(id,key)=>{this._WSS._Clients.filter(client=>client.key.hashed===key).forEach(client=>{client.RegServices.includes("process")||client.RegServices.push("Process")}),this._SubID[id]||(this._SubID[id]=key)}),Object.on("repl-read",msg=>{let data=this.LHPifyReplMsg(msg);this.Send(data)}),Object.on("sensor-read",msg=>{console.log(msg)}),Object.on("process-read",msg=>{})}TestReceive(msg){Object.emit(msg.com,msg.arg)}Receive(_data,_key){let obj=null;try{obj=JSON.parse(_data)}catch(e){throw new err("Incorrect JSON data")}let key=_key,meta_crc=obj.MetaData.CRC,actual_crc;if(delete obj.MetaData.CRC,E.CRC32(JSON.stringify(obj))===meta_crc){let flag=!0;obj.MetaData.Command.forEach(comObj=>{flag&&(comObj.com.endsWith("sub")||comObj.com.endsWith("cm")?(Object.emit(comObj.com,obj.MetaData.ID,key),flag=!1):Object.emit(comObj.com,comObj.arg,obj.MetaData.ID))})}}Send(data){data.MetaData.CRC=E.CRC32(JSON.stringify(data)),this._WSS.Notify(data)}RemoveSub(key){for(let k of this._SubID)this._SubID[k]===key&&delete this._SubID[k];0===Object.keys(this._SubID).length&&Object.emit("repl-cm","EWI")}LHPifyReplMsg(msg){return{MetaData:{Type:"controller",ID:process.env.SERIAL,TimeStamp2:getTime(),Repl:{com:""},RegServices:"Repl"},Value:msg}}LHPifySensorMsg(msg){return msg}}exports=ProxyWS;